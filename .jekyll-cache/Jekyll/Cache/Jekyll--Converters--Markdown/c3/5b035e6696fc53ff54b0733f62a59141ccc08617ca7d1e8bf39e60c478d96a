I"c<p>EC2 IAMãƒ­ãƒ¼ãƒ«ã®ä½œæˆã¨é©ç”¨ã‚’CLIã‹ã‚‰è¡Œã†</p>

<p>AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã§ã‚ã‚Œã°ç°¡å˜ãªã‚“ã§ã™ãŒã€CLIã‹ã‚‰ã ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆEC2 IAMãƒ­ãƒ¼ãƒ«)ã‚’ä½œã‚‹ã®ã«ãƒ­ãƒ¼ãƒ«ã®ä½œæˆã‹ã‚‰å¿…è¦ãªã®ã§è‹¥å¹²é¢å€’ã§ã™ã€‚</p>

<p>ã“ã“ã§ã¯å‰æã¨ã—ã¦ã€è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ãã‚Œãã‚Œé•ã†ãƒ­ãƒ¼ãƒ«(ãƒãƒªã‚·ãƒ¼ã¯åŒä¸€)ã‚’é©ç”¨ã—ã¾ã™ã€‚</p>

<p>è¡¨ã«ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚</p>

<table>
  <tbody>
    <tr>
      <td>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID</td>
      <td>ãƒ­ãƒ¼ãƒ«å / ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å</td>
      <td>ãƒãƒªã‚·ãƒ¼ARN</td>
    </tr>
    <tr>
      <td>instanceid1</td>
      <td>rolename1</td>
      <td>arn:aws:iam::aws:policy/service-role/servicerole</td>
    </tr>
    <tr>
      <td>instanceid2</td>
      <td>rolename2</td>
      <td>arn:aws:iam::aws:policy/service-role/servicerole</td>
    </tr>
  </tbody>
</table>

<h2 id="æ‰‹é †">æ‰‹é †</h2>

<h3 id="assume-roleã‚’æº–å‚™">Assume-roleã‚’æº–å‚™</h3>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">_EOF</span><span class="sh"> &gt; Trust-Policy.json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "ec2.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
_EOF</span></code></pre></figure>

<h3 id="ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ­ãƒ¼ãƒ«ä½œæˆã¨ãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒ">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ­ãƒ¼ãƒ«ä½œæˆã¨ãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒ</h3>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">INSTANCE_ROLE_NAMES</span><span class="o">=(</span>
  rolename1
  rolename2
<span class="o">)</span>
<span class="k">for </span>INSTANCE_ROLE_NAME <span class="k">in</span> <span class="k">${</span><span class="nv">INSTANCE_ROLE_NAMES</span><span class="p">[@]</span><span class="k">}</span><span class="p">;</span>
<span class="k">do</span>
  <span class="c"># ãƒ­ãƒ¼ãƒ«ä½œæˆ</span>
  aws iam create-role <span class="nt">--role-name</span> <span class="nv">$INSTANCE_ROLE_NAME</span> <span class="nt">--assume-role-policy-document</span> file://Trust-Policy.json
  <span class="c"># ãƒ­ãƒ¼ãƒ«ã«ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ</span>
  aws iam attach-role-policy <span class="nt">--role-name</span> <span class="nv">$INSTANCE_ROLE_NAME</span> <span class="nt">--policy-arn</span> arn:aws:iam::aws:policy/service-role/servicerole
  <span class="c"># ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ</span>
  aws iam create-instance-profile <span class="nt">--instance-profile-name</span> <span class="nv">$INSTANCE_ROLE_NAME</span>
  <span class="c"># ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒ</span>
  aws iam add-role-to-instance-profile <span class="nt">--role-name</span> <span class="nv">$INSTANCE_ROLE_NAME</span> <span class="nt">--instance-profile-name</span> <span class="nv">$INSTANCE_ROLE_NAME</span>
<span class="k">done</span></code></pre></figure>

<h3 id="ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒ">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒ</h3>

<p>â€»åœæ­¢ä¸­ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å ´åˆã€èµ·å‹•ã—ãªã„ã¨è¡¨ç¤ºä¸Šåæ˜ ã•ã‚Œãªã„</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">aws ec2 associate-iam-instance-profile <span class="nt">--instance-id</span> instanceid1 <span class="nt">--iam-instance-profile</span> <span class="nv">Name</span><span class="o">=</span>rolename1
aws ec2 associate-iam-instance-profile <span class="nt">--instance-id</span> instanceid2 <span class="nt">--iam-instance-profile</span> <span class="nv">Name</span><span class="o">=</span>rolename2</code></pre></figure>

<p>å‚è€ƒ:
https://aws.amazon.com/jp/blogs/news/new-attach-an-aws-iam-role-to-an-existing-amazon-ec2-instance-by-using-the-aws-cli/</p>

:ET